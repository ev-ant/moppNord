\ProvidesPackage{MOPP}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{positioning, fit}
\usepackage[style=authoryear,natbib=true, backend=bibtex]{biblatex}
\usepackage{lipsum}
\setmainfont{Calibri}
\usepackage{setspace}
\usepackage{pdfpages}
\usepackage{lastpage}
\usepackage{appendix}

\usepackage{fancyhdr}
\fancypagestyle{main}{%\fancyhf
    \renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\iffloatpage{}{\thepage}}
\fancyhead[LO]{}
\fancyhead[RO]{}
\fancyhead[LE]{}
\fancyhead[RE]{}
}

\renewcommand\thechapter{}
\renewcommand\thesection{\arabic{section}}
\renewcommand\thesubsection{\thesection.\arabic{subsection}}
\renewcommand\thesubsubsection{\thesubsection.\arabic{subsubsection}}
\renewcommand\theparagraph{}
\renewcommand\thesubparagraph{}
\renewcommand\thefigure{\arabic{figure}}
\renewcommand\thetable{\arabic{table}}


\usepackage{tocloft,titlesec}
\titleformat{\chapter}[hang]
{\normalfont\Large\bfseries}{\thechapter}{1em}{}
\titlespacing*{\chapter} {0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}

\titleformat{\paragraph}[display]
{\normalfont\bfseries\fillast}
{{\theparagraph}}
{1ex minus .1ex}
{\small}
\titlespacing{\paragraph}{3pc}{*3}{*2}[3pc]


\AtBeginDocument{\let\maketitle\relax}

\makeatletter\let\Title\@title\makeatother
\makeatletter\let\Author\@author\makeatother
\makeatletter\let\Date\@date\makeatother

\def\MainTitle{MASTEROPPGAVE}
\def\course{Emnecode: }
\def\Candit{Kandidat }
\def\School{Handelsh{\o}gskolen i Nord}

\def\clocktime{Dato: }
\def\Student{Navn / kandidatnr.: }
\def\totPages{Totalt antall sider: }
\renewcommand{\contentsname}{Innholdsfortegnelse}
\renewcommand{\listtablename}{Oversikt over tabeller}
\renewcommand{\listfigurename}{Oversikt over figurer}
\def\logoPic{\includegraphics[trim={5mm 10mm 5mm 7mm}, clip, height = 1.7cm]{resource/logo_NORD}}
\def\Litname{Litteraturliste}
\renewcommand{\figurename}{Figur}
\renewcommand{\tablename}{Tabell}
\renewcommand{\equationautorefname}{Ligning}
\def\chOne{Kappe}
\def\chTwo{Vitenskapelig artikkel}
\renewcommand{\appendixtocname}{Appendiks}
\newcommand{\listappssname}{Oversikt over appendiks}

\def\inEnglish{
\renewcommand{\MainTitle}{MASTER THESIS}
\renewcommand{\course}{Course code: }
\renewcommand{\clocktime}{Date: }
\renewcommand{\Student}{Name / Candidate no.: }
\renewcommand{\Candit}{Candidate}
\renewcommand{\School}{Nord University Business School}
\renewcommand{\totPages}{Total number of pages: }
\renewcommand{\contentsname}{Table of contents}
\renewcommand{\listtablename}{List of tables}
\renewcommand{\listfigurename}{List of figures}
\renewcommand{\logoPic}{\includegraphics[height = 1.65cm]{resource/nordlogoen}}
\renewcommand{\Litname}{References}
\renewcommand{\figurename}{Figure}
\renewcommand{\tablename}{Table}
\renewcommand{\equationautorefname}{Equation}
\renewcommand{\chOne}{Introduction}
\renewcommand{\chTwo}{Scientific article}
\renewcommand{\appendixtocname}{Appendices}
\renewcommand{\listappssname}{List of Appendices}
}


\definecolor{nordblue}{RGB}{0, 176, 185}
\definecolor{nordgrey}{RGB}{148, 183, 187}
\def\haveApp{}
\newcommand{\withAppendices}[1]{\renewcommand{\haveApp}{#1}}

\def\MoppTitle{ \frontmatter   \input{resource/frontpage}}

\def\MoppLists{\newpage
  \tableofcontents
      \addcontentsline{toc}{chapter}{\contentsname}\newpage
\listoffigures
      \addcontentsline{toc}{chapter}{\listfigurename}\newpage
    \listoftables
      \addcontentsline{toc}{chapter}{\listtablename}
      \ifthenelse{\equal{\haveApp}{yes}}
        {\newpage
        \listofappendix
        \addcontentsline{toc}{chapter}{\listappssname}
        }
        {}
   \mainmatter\pagestyle{main}
   }




\newcommand{\listappendixname}{\listappssname}
\newlistof{appendix}{apc}{\listappendixname}

\makeatletter


\AtBeginEnvironment{appendices}{%
  \clearpage
  \addcontentsline{toc}{chapter}{\appendixtocname}
  \write\@auxout{%
    \string\let\string\latex@tf@toc\string\tf@toc% Store the original `\tf@toc` file handle
    \string\let\string\tf@toc\string\tf@apc% 
  }% Naughty trick
  \titleformat 
  {\chapter} 
  [display]
  {\huge\bfseries\filcenter} 
  {\Large \MakeUppercase{\@chapapp} \thechapter} 
  {1.5ex}{}
  {}
}

\AtEndEnvironment{appendices}{%
  \write\@auxout{%
    \string\let\string\tf@toc\string\latex@tf@toc% 
  }% Naughty trick, restoring the old `\tf@toc` number, to be able to write stuff to the real `.toc` again.
}

\makeatother



% \def\withAppendices{
% \renewcommand{\MoppLists}{\newpage
%   \tableofcontents
%       \addcontentsline{toc}{chapter}{\contentsname}\newpage
% \listoffigures
%       \addcontentsline{toc}{chapter}{\listfigurename}\newpage
%     \listoftables
%       \addcontentsline{toc}{chapter}{\listtablename}\newpage
% \listofappendix
%       \addcontentsline{toc}{chapter}{\listappssname}
%  \mainmatter\pagestyle{main}
%    }}
\def\Appendices{
   \begin{appendices}
}

\def\MoppRefs{
\ifthenelse{\equal{\haveApp}{yes}}{\end{appendices}}{}
  \newpage
  \backmatter
  \chapter{\Litname}}
  

